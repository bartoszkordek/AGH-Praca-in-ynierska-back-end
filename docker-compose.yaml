version: "3.8"

networks:
  backend:

services:
  config-server:
    container_name: config-server
    image: gza73/agh-praca-inzynierska-config-server:latest
    environment:
      - "SPRING_PROFILES_ACTIVE=docker,native"
    volumes:
      - ./properties:/home/healthy-gym-config
    ports:
      - "8030:8030"
    networks:
      - backend
    deploy:
      replicas: 1

  discovery:
    container_name: discovery
    image: gza73/agh-praca-inzynierska-discovery:latest
    environment:
      - "SPRING_PROFILES_ACTIVE=docker"
    ports:
      - "8010:8010"
    networks:
      - backend
    depends_on:
      - config-server
    deploy:
      replicas: 1

  gateway:
    container_name: gateway
    image: gza73/agh-praca-inzynierska-gateway:latest
    environment:
      - "SPRING_PROFILES_ACTIVE=docker"
    ports:
      - "8020:8020"
    networks:
      - backend
    depends_on:
      - discovery
    deploy:
      replicas: 1

  mongodb:
    container_name: mongodb
    image: gza73/agh-praca-inzynierska-mongodb:latest
    ports:
      - "27017:27017"
    networks:
      - backend
    volumes:
      - ./mongodb/dump:/home/dump
    deploy:
      replicas: 1

  auth:
    container_name: auth
    image: gza73/agh-praca-inzynierska-auth:latest
    environment:
      - "SPRING_PROFILES_ACTIVE=docker,production"
    networks:
      - backend
    depends_on:
      - mongodb
      - gateway
    deploy:
      replicas: 1

  account:
    container_name: account
    image: gza73/agh-praca-inzynierska-account:latest
    environment:
      - "SPRING_PROFILES_ACTIVE=docker"
    networks:
      - backend
    depends_on:
      - mongodb
      - gateway
    deploy:
      replicas: 1

  gympass:
    container_name: gympass
    image: gza73/agh-praca-inzynierska-gympass:latest
    environment:
      - "SPRING_PROFILES_ACTIVE=docker"
    networks:
      - backend
    depends_on:
      - mongodb
      - gateway
    deploy:
      replicas: 1

  task:
    container_name: task
    image: gza73/agh-praca-inzynierska-task:latest
    environment:
      - "SPRING_PROFILES_ACTIVE=docker"
    networks:
      - backend
    depends_on:
      - mongodb
      - gateway
    deploy:
      replicas: 1

  redis:
    container_name: redis
    image: gza73/agh-praca-inzynierska-redis:latest
    ports:
      - "6379:6379"
    networks:
      - backend
    deploy:
      replicas: 1

  rabbitmq:
    container_name: rabbitmq
    image: gza73/agh-praca-inzynierska-rabbitmq:latest
    ports:
      - "5672:5672"
      - "15672:15672"
    deploy:
      replicas: 1
    networks:
      - backend